{"version":3,"file":"author-datalist.es5.min.js","sources":["../src/element.js"],"sourcesContent":["class AuthorDatalistElement extends AuthorElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.clickCount = 0\n\n    this.PRIVATE.addReadOnlyProperty('options')\n\n    this.PRIVATE.options = []\n\n    this.PRIVATE.find = query => {\n      return this.PRIVATE.options.filter(option => {\n        let value = this.hasAttribute('case-sensitive') ? option.sourceElement.value : option.sourceElement.value.toLowerCase()\n        let text = this.hasAttribute('case-sensitive') ? option.sourceElement.text : option.sourceElement.text.toLowerCase()\n        query = this.hasAttribute('case-sensitive') ? query : query.toLowerCase()\n\n        return value.indexOf(query) >= 0 || text.indexOf(query) >= 0\n      })\n    }\n\n    this.PRIVATE.clear = () => {\n      this.PRIVATE.options.forEach(option => option.displayElement.style.display = 'none')\n    }\n\n    this.PRIVATE.showAllOptions = () => {\n      this.PRIVATE.options.forEach(option => option.displayElement.style.display = '')\n    }\n\n    this.PRIVATE.clickHandler = evt => {\n      this.clickCount++\n\n      if (this.clickCount === 2) {\n        this.PRIVATE.showAllOptions()\n        this.open()\n      }\n    }\n\n    this.PRIVATE.keydownHandler = evt => {\n      if (!this.isOpen) {\n        this.PRIVATE.showAllOptions()\n        return this.open()\n      }\n\n      switch (evt[this.keySource]) {\n        case 27:\n        case 'Escape':\n          this.PRIVATE.clear()\n          this.close()\n          break\n\n        case 38:\n        case 'ArrowUp':\n          evt.preventDefault()\n          console.log('select previous option');\n          break\n\n        case 40:\n        case 'ArrowDown':\n          evt.preventDefault()\n          console.log('select next option');\n          break\n\n        default:\n          return\n      }\n    }\n\n    this.PRIVATE.inputHandler = evt => {\n      this.PRIVATE.clear()\n      let query = this.PRIVATE.inputEl.value\n\n      if (!query) {\n        return\n      }\n\n      let results = this.PRIVATE.find(query)\n\n      if (results.length) {\n        results.forEach(result => result.displayElement.style.display = '')\n        this.setAttribute('open', '')\n        return\n      }\n\n      if (this.hasAttribute('open')) {\n        this.removeAttribute('open')\n      }\n\n      this.PRIVATE.clear()\n    }\n\n    this.PRIVATE.bodyClickHandler = evt => {\n      if (evt.target === this || this.contains(evt.target)) {\n        return\n      }\n\n      this.removeAttribute('open')\n    }\n\n    this.PRIVATE.getOptionById = (id) => {\n      let options = this.PRIVATE.options\n      let option\n\n      for (let i = 0; i < options.length; i++) {\n        if (options[i].id === id) {\n          option = options[i]\n          break\n        }\n      }\n\n      return option\n    }\n\n    this.PRIVATE.generateOptionObject = optionEl => {\n      if (!customElements.get('chassis-option')) {\n        console.error(`chassis-datalist requires chassis-option. Please include it in this document's <head> element.`)\n        return\n      }\n\n      let obj = {\n        id: this.PRIVATE.generateGuid('option'),\n        attributes: {},\n        sourceElement: optionEl\n      }\n\n      for (let attr of optionEl.attributes) {\n        obj.attributes[attr.name] = attr.value\n      }\n\n      return obj\n    }\n  }\n\n  static get observedAttributes () {\n    return ['autofocus', 'case-sensitive', 'disabled', 'name', 'open', 'tabindex']\n  }\n\n  get isOpen () {\n    return this.hasAttribute('open')\n  }\n\n  set isOpen (bool) {\n    bool ? this.setAttribute('open', '') : this.removeAttribute('open')\n  }\n\n  get value () {\n    return this.PRIVATE.inputEl.value\n  }\n\n  connectedCallback () {\n    this.PRIVATE.inputEl.addEventListener('focus', evt => {\n      this.addEventListener('keydown', this.PRIVATE.keydownHandler)\n    })\n\n    this.PRIVATE.inputEl.addEventListener('input', this.PRIVATE.inputHandler)\n\n    this.PRIVATE.inputEl.addEventListener('click', this.PRIVATE.clickHandler)\n\n    this.PRIVATE.inputEl.addEventListener('blur', evt => {\n      this.clickCount = 0\n      this.removeEventListener('keydown', this.PRIVATE.keydownHandler)\n    })\n\n    setTimeout(() => {\n      if (!this.hasAttribute('tabindex')) {\n        this.setAttribute('tabindex', 0)\n      }\n\n      if (this.autofocus) {\n        this.focus()\n      }\n    }, 0)\n  }\n\n  addChildren (children) {\n    for (let child of children) {\n      this.addOption(child instanceof HTMLElement ? this.PRIVATE.generateOptionObject(child) : child)\n    }\n  }\n\n  addOption (option, index, dest = this.PRIVATE.optionsEl) {\n    if (!customElements.get('chassis-option')) {\n      console.error(`chassis-datalist requires chassis-option. Please include it in this document's <head> element.`)\n      return\n    }\n\n    if (!option.hasOwnProperty('id')) {\n      option.id = this.PRIVATE.generateGuid('option')\n    }\n\n    if (!option.hasOwnProperty('sourceElement') || !(option.sourceElement instanceof HTMLElement)) {\n      let sourceEl = document.createElement('option')\n\n      if (option.hasOwnProperty('innerHTML')) {\n        sourceEl.innerHTML = option.innerHTML\n      }\n\n      if (option.hasOwnProperty('label')) {\n        sourceEl.innerHTML = option.label\n      }\n\n      if (option.hasOwnProperty('value')) {\n        sourceEl.value = option.value\n      }\n\n      if (option.hasOwnProperty('disabled')) {\n        sourceEl.disabled = typeof option.disabled === 'boolean' && option.disabled\n      }\n\n      option.sourceElement = sourceEl\n    }\n\n    let label = option.sourceElement.getAttribute('label') || option.sourceElement.textContent.trim()\n    let value = option.sourceElement.getAttribute('value')\n    let disabled = option.sourceElement.disabled\n    let chassisOption = document.createElement('chassis-option')\n\n    chassisOption.style.display = 'none'\n    chassisOption.key = option.id\n    chassisOption.innerHTML = option.sourceElement.innerHTML\n\n    dest.appendChild(chassisOption)\n    chassisOption.addEventListener('click', evt => this.select(chassisOption.key))\n\n    option = {\n      attributes: { disabled, label, value },\n      id: option.id,\n      displayElement: chassisOption,\n      sourceElement: option.sourceElement\n    }\n\n    if (index) {\n      this[`${index}`] = option.sourceElement\n      this.PRIVATE.options.splice(index, 0, option)\n      return\n    }\n\n    this[`${this.PRIVATE.options.length}`] = option.sourceElement\n    this.PRIVATE.options.push(option)\n  }\n\n  attributeChangedCallback (attr, oldValue, newValue) {\n    attr = attr.toLowerCase()\n\n    if (newValue === oldValue) {\n      return\n    }\n\n    switch (attr) {\n      case 'autofocus':\n      case 'disabled':\n        console.log(attr);\n        // this.PRIVATE.setBooleanAttributeValue(attr, newValue)\n        break\n\n      case 'name':\n        console.log(attr);\n        // this.PRIVATE.setAttributeValue(attr, newValue)\n        break\n\n      case 'open':\n        this.isOpen ? this.open() : this.close()\n        break\n    }\n  }\n\n  close () {\n    document.body.removeEventListener('click', this.PRIVATE.bodyClickHandler)\n    document.body.removeEventListener('touchcancel', this.PRIVATE.bodyClickHandler)\n    document.body.removeEventListener('touchend', this.PRIVATE.bodyClickHandler)\n\n    if (this.isOpen) {\n      this.isOpen = false\n    }\n  }\n\n  open () {\n    document.body.addEventListener('click', this.PRIVATE.bodyClickHandler)\n    document.body.addEventListener('touchcancel', this.PRIVATE.bodyClickHandler)\n    document.body.addEventListener('touchend', this.PRIVATE.bodyClickHandler)\n\n    if (!this.isOpen) {\n      this.isOpen = true\n    }\n  }\n\n  inject (input, datalist, guid) {\n    this.PRIVATE.sourceEl = datalist\n    this.PRIVATE.inputEl = input\n    this.PRIVATE.inputEl.slot = 'input'\n    this.PRIVATE.inputEl.id = guid\n    this.appendChild(this.PRIVATE.inputEl)\n\n    this.PRIVATE.optionsEl = document.createElement('chassis-options')\n    this.PRIVATE.optionsEl.slot = 'options'\n\n    this.appendChild(this.PRIVATE.optionsEl)\n\n    this.addChildren(datalist.options)\n  }\n\n  select (id) {\n    let option = this.PRIVATE.getOptionById(id)\n\n    if (option) {\n      option.sourceElement.selected = true\n      this.PRIVATE.inputEl.value = option.displayElement.innerHTML\n      this.PRIVATE.selectedOption = option\n\n      this.PRIVATE.options.forEach(option => option.displayElement.removeAttribute('selected'))\n      option.displayElement.setAttribute('selected', '')\n\n      this.dispatchEvent(new Event('input', {\n        bubbles: true\n      }))\n\n      this.close()\n    }\n  }\n}\n\ncustomElements.define('chassis-datalist', AuthorDatalistElement)\n"],"names":["AuthorDatalistElement","clickCount","PRIVATE","addReadOnlyProperty","options","find","query","_this","filter","option","value","hasAttribute","sourceElement","toLowerCase","text","indexOf","clear","forEach","displayElement","style","display","showAllOptions","clickHandler","evt","open","keydownHandler","isOpen","keySource","close","preventDefault","console","log","inputHandler","inputEl","results","length","result","setAttribute","removeAttribute","bodyClickHandler","target","contains","getOptionById","id","i","generateOptionObject","optionEl","customElements","get","obj","generateGuid","attributes","attr","name","error","AuthorElement","HTMLElement","addEventListener","_this2","this","removeEventListener","setTimeout","autofocus","focus","children","child","addOption","index","dest","optionsEl","hasOwnProperty","sourceEl","document","createElement","innerHTML","label","disabled","getAttribute","textContent","trim","chassisOption","key","appendChild","_this3","select","splice","push","oldValue","newValue","body","input","datalist","guid","slot","addChildren","selected","selectedOption","dispatchEvent","Event","bubbles","bool","define"],"mappings":"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"}
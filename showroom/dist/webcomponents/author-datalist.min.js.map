{"version":3,"file":"author-datalist.min.js","sources":["../src/element.js"],"sourcesContent":["class AuthorDatalistElement extends AuthorElement(HTMLElement) {\n  constructor () {\n    super(`{{TEMPLATE-STRING}}`)\n\n    this.clickCount = 0\n\n    this.PRIVATE.addReadOnlyProperty('options')\n\n    this.PRIVATE.options = []\n\n    this.PRIVATE.find = query => {\n      return this.PRIVATE.options.filter(option => {\n        let value = this.hasAttribute('case-sensitive') ? option.sourceElement.value : option.sourceElement.value.toLowerCase()\n        let text = this.hasAttribute('case-sensitive') ? option.sourceElement.text : option.sourceElement.text.toLowerCase()\n        query = this.hasAttribute('case-sensitive') ? query : query.toLowerCase()\n\n        return value.indexOf(query) >= 0 || text.indexOf(query) >= 0\n      })\n    }\n\n    this.PRIVATE.clear = () => {\n      this.PRIVATE.options.forEach(option => option.displayElement.style.display = 'none')\n    }\n\n    this.PRIVATE.showAllOptions = () => {\n      this.PRIVATE.options.forEach(option => option.displayElement.style.display = '')\n    }\n\n    this.PRIVATE.clickHandler = evt => {\n      this.clickCount++\n\n      if (this.clickCount === 2) {\n        this.PRIVATE.showAllOptions()\n        this.open()\n      }\n    }\n\n    this.PRIVATE.keydownHandler = evt => {\n      if (!this.isOpen) {\n        this.PRIVATE.showAllOptions()\n        return this.open()\n      }\n\n      switch (evt[this.keySource]) {\n        case 27:\n        case 'Escape':\n          this.PRIVATE.clear()\n          this.close()\n          break\n\n        case 38:\n        case 'ArrowUp':\n          evt.preventDefault()\n          console.log('select previous option');\n          break\n\n        case 40:\n        case 'ArrowDown':\n          evt.preventDefault()\n          console.log('select next option');\n          break\n\n        default:\n          return\n      }\n    }\n\n    this.PRIVATE.inputHandler = evt => {\n      this.PRIVATE.clear()\n      let query = this.PRIVATE.inputEl.value\n\n      if (!query) {\n        return\n      }\n\n      let results = this.PRIVATE.find(query)\n\n      if (results.length) {\n        results.forEach(result => result.displayElement.style.display = '')\n        this.setAttribute('open', '')\n        return\n      }\n\n      if (this.hasAttribute('open')) {\n        this.removeAttribute('open')\n      }\n\n      this.PRIVATE.clear()\n    }\n\n    this.PRIVATE.bodyClickHandler = evt => {\n      if (evt.target === this || this.contains(evt.target)) {\n        return\n      }\n\n      this.removeAttribute('open')\n    }\n\n    this.PRIVATE.getOptionById = (id) => {\n      let options = this.PRIVATE.options\n      let option\n\n      for (let i = 0; i < options.length; i++) {\n        if (options[i].id === id) {\n          option = options[i]\n          break\n        }\n      }\n\n      return option\n    }\n\n    this.PRIVATE.generateOptionObject = optionEl => {\n      if (!customElements.get('chassis-option')) {\n        console.error(`chassis-datalist requires chassis-option. Please include it in this document's <head> element.`)\n        return\n      }\n\n      let obj = {\n        id: this.PRIVATE.generateGuid('option'),\n        attributes: {},\n        sourceElement: optionEl\n      }\n\n      for (let attr of optionEl.attributes) {\n        obj.attributes[attr.name] = attr.value\n      }\n\n      return obj\n    }\n  }\n\n  static get observedAttributes () {\n    return ['autofocus', 'case-sensitive', 'disabled', 'name', 'open', 'tabindex']\n  }\n\n  get isOpen () {\n    return this.hasAttribute('open')\n  }\n\n  set isOpen (bool) {\n    bool ? this.setAttribute('open', '') : this.removeAttribute('open')\n  }\n\n  get value () {\n    return this.PRIVATE.inputEl.value\n  }\n\n  connectedCallback () {\n    this.PRIVATE.inputEl.addEventListener('focus', evt => {\n      this.addEventListener('keydown', this.PRIVATE.keydownHandler)\n    })\n\n    this.PRIVATE.inputEl.addEventListener('input', this.PRIVATE.inputHandler)\n\n    this.PRIVATE.inputEl.addEventListener('click', this.PRIVATE.clickHandler)\n\n    this.PRIVATE.inputEl.addEventListener('blur', evt => {\n      this.clickCount = 0\n      this.removeEventListener('keydown', this.PRIVATE.keydownHandler)\n    })\n\n    setTimeout(() => {\n      if (!this.hasAttribute('tabindex')) {\n        this.setAttribute('tabindex', 0)\n      }\n\n      if (this.autofocus) {\n        this.focus()\n      }\n    }, 0)\n  }\n\n  addChildren (children) {\n    for (let child of children) {\n      this.addOption(child instanceof HTMLElement ? this.PRIVATE.generateOptionObject(child) : child)\n    }\n  }\n\n  addOption (option, index, dest = this.PRIVATE.optionsEl) {\n    if (!customElements.get('chassis-option')) {\n      console.error(`chassis-datalist requires chassis-option. Please include it in this document's <head> element.`)\n      return\n    }\n\n    if (!option.hasOwnProperty('id')) {\n      option.id = this.PRIVATE.generateGuid('option')\n    }\n\n    if (!option.hasOwnProperty('sourceElement') || !(option.sourceElement instanceof HTMLElement)) {\n      let sourceEl = document.createElement('option')\n\n      if (option.hasOwnProperty('innerHTML')) {\n        sourceEl.innerHTML = option.innerHTML\n      }\n\n      if (option.hasOwnProperty('label')) {\n        sourceEl.innerHTML = option.label\n      }\n\n      if (option.hasOwnProperty('value')) {\n        sourceEl.value = option.value\n      }\n\n      if (option.hasOwnProperty('disabled')) {\n        sourceEl.disabled = typeof option.disabled === 'boolean' && option.disabled\n      }\n\n      option.sourceElement = sourceEl\n    }\n\n    let label = option.sourceElement.getAttribute('label') || option.sourceElement.textContent.trim()\n    let value = option.sourceElement.getAttribute('value')\n    let disabled = option.sourceElement.disabled\n    let chassisOption = document.createElement('chassis-option')\n\n    chassisOption.style.display = 'none'\n    chassisOption.key = option.id\n    chassisOption.innerHTML = option.sourceElement.innerHTML\n\n    dest.appendChild(chassisOption)\n    chassisOption.addEventListener('click', evt => this.select(chassisOption.key))\n\n    option = {\n      attributes: { disabled, label, value },\n      id: option.id,\n      displayElement: chassisOption,\n      sourceElement: option.sourceElement\n    }\n\n    if (index) {\n      this[`${index}`] = option.sourceElement\n      this.PRIVATE.options.splice(index, 0, option)\n      return\n    }\n\n    this[`${this.PRIVATE.options.length}`] = option.sourceElement\n    this.PRIVATE.options.push(option)\n  }\n\n  attributeChangedCallback (attr, oldValue, newValue) {\n    attr = attr.toLowerCase()\n\n    if (newValue === oldValue) {\n      return\n    }\n\n    switch (attr) {\n      case 'autofocus':\n      case 'disabled':\n        console.log(attr);\n        // this.PRIVATE.setBooleanAttributeValue(attr, newValue)\n        break\n\n      case 'name':\n        console.log(attr);\n        // this.PRIVATE.setAttributeValue(attr, newValue)\n        break\n\n      case 'open':\n        this.isOpen ? this.open() : this.close()\n        break\n    }\n  }\n\n  close () {\n    document.body.removeEventListener('click', this.PRIVATE.bodyClickHandler)\n    document.body.removeEventListener('touchcancel', this.PRIVATE.bodyClickHandler)\n    document.body.removeEventListener('touchend', this.PRIVATE.bodyClickHandler)\n\n    if (this.isOpen) {\n      this.isOpen = false\n    }\n  }\n\n  open () {\n    document.body.addEventListener('click', this.PRIVATE.bodyClickHandler)\n    document.body.addEventListener('touchcancel', this.PRIVATE.bodyClickHandler)\n    document.body.addEventListener('touchend', this.PRIVATE.bodyClickHandler)\n\n    if (!this.isOpen) {\n      this.isOpen = true\n    }\n  }\n\n  inject (input, datalist, guid) {\n    this.PRIVATE.sourceEl = datalist\n    this.PRIVATE.inputEl = input\n    this.PRIVATE.inputEl.slot = 'input'\n    this.PRIVATE.inputEl.id = guid\n    this.appendChild(this.PRIVATE.inputEl)\n\n    this.PRIVATE.optionsEl = document.createElement('chassis-options')\n    this.PRIVATE.optionsEl.slot = 'options'\n\n    this.appendChild(this.PRIVATE.optionsEl)\n\n    this.addChildren(datalist.options)\n  }\n\n  select (id) {\n    let option = this.PRIVATE.getOptionById(id)\n\n    if (option) {\n      option.sourceElement.selected = true\n      this.PRIVATE.inputEl.value = option.displayElement.innerHTML\n      this.PRIVATE.selectedOption = option\n\n      this.PRIVATE.options.forEach(option => option.displayElement.removeAttribute('selected'))\n      option.displayElement.setAttribute('selected', '')\n\n      this.dispatchEvent(new Event('input', {\n        bubbles: true\n      }))\n\n      this.close()\n    }\n  }\n}\n\ncustomElements.define('chassis-datalist', AuthorDatalistElement)\n"],"names":["customElements","define","AuthorElement","HTMLElement","[object Object]","super","this","clickCount","PRIVATE","addReadOnlyProperty","options","find","query","filter","option","value","hasAttribute","sourceElement","toLowerCase","text","indexOf","clear","forEach","displayElement","style","display","showAllOptions","clickHandler","evt","open","keydownHandler","isOpen","keySource","close","preventDefault","console","log","inputHandler","inputEl","results","length","result","setAttribute","removeAttribute","bodyClickHandler","target","contains","getOptionById","id","i","generateOptionObject","optionEl","get","error","obj","generateGuid","attributes","attr","name","observedAttributes","bool","addEventListener","removeEventListener","setTimeout","autofocus","focus","children","child","addOption","index","dest","optionsEl","hasOwnProperty","sourceEl","document","createElement","innerHTML","label","disabled","getAttribute","textContent","trim","chassisOption","key","appendChild","select","splice","push","oldValue","newValue","body","input","datalist","guid","slot","addChildren","selected","selectedOption","dispatchEvent","Event","bubbles"],"mappings":"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"}